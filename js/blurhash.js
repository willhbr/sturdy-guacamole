const dc="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~".split(""),decode83=t=>{let e=0;for(let o=0;o<t.length;o++){const r=t[o];e=83*e+dc.indexOf(r)}return e},validateBlurhash=t=>{if(!t||t.length<6)throw new Error("need >6 chars: ", t);const e=decode83(t[0]),o=Math.floor(e/9)+1,r=e%9+1;if(t.length!==4+2*r*o)throw new Error(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*r*o}`)},sRGBToLinear=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},linearTosRGB=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(12.92*e*255+.5):Math.trunc(255*(1.055*Math.pow(e,1/2.4)-.055)+.5)},sign=t=>t<0?-1:1,signPow=(t,e)=>sign(t)*Math.pow(Math.abs(t),e),decodeAC=(t,e)=>{const o=Math.floor(t/361),r=Math.floor(t/19)%19,n=t%19;return[signPow((o-9)/9,2)*e,signPow((r-9)/9,2)*e,signPow((n-9)/9,2)*e]},decodeDC=t=>{const e=t>>8&255,o=255&t;return[sRGBToLinear(t>>16),sRGBToLinear(e),sRGBToLinear(o)]},decode=(t,e,o,r)=>{validateBlurhash(t),r|=1;const n=decode83(t[0]),a=Math.floor(n/9)+1,s=n%9+1,l=(decode83(t[1])+1)/166,h=new Array(s*a);for(let e=0;e<h.length;e++)if(0===e){const o=decode83(t.substring(2,6));h[e]=decodeDC(o)}else{const o=decode83(t.substring(4+2*e,6+2*e));h[e]=decodeAC(o,l*r)}const i=4*e,d=new Uint8ClampedArray(i*o);for(let t=0;t<o;t++)for(let r=0;r<e;r++){let n=0,l=0,c=0;for(let i=0;i<a;i++)for(let a=0;a<s;a++){const d=Math.cos(Math.PI*r*a/e)*Math.cos(Math.PI*t*i/o);let u=h[a+i*s];n+=u[0]*d,l+=u[1]*d,c+=u[2]*d}let u=linearTosRGB(n),g=linearTosRGB(l),M=linearTosRGB(c);d[4*r+0+t*i]=u,d[4*r+1+t*i]=g,d[4*r+2+t*i]=M,d[4*r+3+t*i]=255}return d};
